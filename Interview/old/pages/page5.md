---
url: /Interview/old/pages/page5.md
---
# 前端缓存

## 一、什么是前端缓存？

前端缓存是指在客户端（浏览器）或靠近客户端的网络节点中临时存储资源的一种机制。其目的是减少网络请求、提高页面加载速度、减轻服务器压力，从而提升用户体验和性能。

***

## 二、前端缓存的分类

前端缓存主要分为两大类：**HTTP 缓存** 和 **本地存储类缓存**。

* 强缓存：完全依赖于浏览器缓存，当缓存未过期时直接使用，不与服务器交互。
* 协商缓存：需要与服务器进行交互，确保获取到最新的资源，但相对增加了延迟。

### 1. HTTP 缓存

这是浏览器默认支持的缓存机制，根据是否需要重新请求服务器可以分为：

#### （1）强缓存（Strong Cache）

* 浏览器直接从本地缓存读取资源，不向服务器发送请求。
* 控制字段：
  * `Expires`（HTTP/1.0）：指定一个绝对时间，表示在此时间前使用缓存。
  * `Cache-Control`（HTTP/1.1）：更灵活，优先级高于 `Expires`。
    * `max-age=3600`：缓存最大有效时间（单位秒）
    * `no-cache`：每次都要验证
    * `no-store`：不缓存
    * `public / private`：是否允许中间代理缓存

#### （2）协商缓存（Revalidate Cache）

> Last-Modified/If-Modified-Since与ETag/if-None-Match机制是两种常见的协商缓存方式。虽然前者简单易用，但由于其仅精确到秒级，且对于文件名变化敏感度不足，后者更受推荐，因为ETag基于文件内容生成hash值，能更精准地判断资源是否更新

**`补充：`现代实践中，ETag结合版本号（如Git commit ID）用于静态资源管理是一种常见做法，这有助于提高缓存效率并减少不必要的网络请求。**

* 浏览器发送请求，但服务器判断是否使用缓存。
* 控制字段：
  * `Last-Modified / If-Modified-Since`
  * `ETag / If-None-Match`

> 两者的区别：\
> `Last-Modified` 是基于时间的，可能精度不够；\
> `ETag` 是基于资源内容生成的哈希值，更准确。

### 2. 本地存储类缓存（浏览器本地存储）

这些是开发者主动控制的缓存方式：

#### （1）Cookie

* 存储容量小（约4KB），每次请求都会携带在 HTTP 头中。
* 可设置过期时间、作用域等。
* 常用于身份认证信息。

#### （2）LocalStorage

* 容量大（一般5MB左右），持久化存储。
* 不会随请求发送到服务器。
* 生命周期永久，除非手动清除。

#### （3）SessionStorage

* 类似于 LocalStorage，但生命周期仅限当前会话。
* 关闭浏览器标签页后数据被清除。

#### （4）IndexedDB

* 浏览器端的 NoSQL 数据库，适合存储大量结构化数据。
* 异步操作，不会阻塞主线程。
* 支持事务、索引查询等功能。

## 三、缓存的应用场景

| 缓存类型         | 适用场景 |
|------------------|----------|
| `强缓存`           | 静态资源如图片、CSS、JS 文件 |
| `协商缓存`         | 经常更新但变化不频繁的资源 |
| `Cookie`           | 用户登录状态、跟踪信息 |
| `LocalStorage`     | 用户偏好设置、离线数据 |
| `SessionStorage`   | 页面间临时数据传递 |
| `IndexedDB`       | 离线应用、复杂数据存储 |

***

## 四、如何优化缓存策略？

1. **合理设置 Cache-Control**
   * 对不变资源设置较长的 `max-age`
   * 对经常变动资源设置 `no-cache` 或协商缓存

2. **版本号控制静态资源**
   * 如：`app.js?v=1.0.1`，避免缓存污染

3. **利用 Service Worker 实现 PWA 缓存**
   * 可拦截请求并自定义缓存策略
   * 支持离线访问

4. **清理旧缓存**
   * 使用 LocalStorage 或 IndexedDB 时注意及时清理无用数据

***

## 五、常见问题与解决方案

* **缓存失效问题**：使用文件指纹（hash）、版本号等方式强制刷新
* **缓存污染问题**：不同环境（开发、测试、生产）使用不同的命名空间
* **跨域缓存问题**：确保 CORS 设置正确，必要时使用 `Vary` 响应头
* **隐私安全问题**：敏感数据避免使用 LocalStorage，可考虑内存缓存或加密处理

***

## 六、总结

前端缓存是性能优化的重要手段之一。理解各种缓存机制的工作原理及其适用场景，能帮助我们更好地提升网站性能、改善用户体验。同时，也要注意缓存带来的副作用，如缓存过期、一致性等问题，需结合业务需求制定合理的缓存策略。
